<!--pages/customer/customer.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <input type="text" 
             placeholder="è¾“å…¥å§“åæˆ–ç”µè¯æœç´¢" 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             confirm-type="search"
             bindconfirm="onSearch"/>
      <view class="search-icon" bindtap="onSearch">
        <text class="icon">ğŸ”</text>
      </view>
    </view>
    <!-- åº—é“ºé€‰æ‹© -->
    <view class="store-filter" bindtap="showStorePicker">
      <text>{{selectedStore ? selectedStore.name : 'å…¨éƒ¨åº—é“º'}}</text>
      <view class="dropdown-icon"></view>
    </view>
  </view>
  
  <!-- å®¢æˆ·åˆ—è¡¨ -->
  <view class="customer-list">
    <block wx:if="{{customers.length > 0}}">
      <view class="customer-item" wx:for="{{customers}}" wx:key="id" bindtap="navigateToDetail" data-id="{{item.id}}">
        <view class="customer-info">
          <view class="customer-name">{{item.name}}</view>
          <view class="customer-meta">
            <text class="store-name">{{item.store_name}}</text>
            <text class="phone">{{item.phone}}</text>
          </view>
        </view>
        <view class="customer-stats" bindtap="navigateToDetail" data-id="{{item.id}}">
          <view class="stat-item">
            <text class="stat-label">å½“å‰ä½“é‡</text>
            <text class="stat-value">{{item.current_weight || '-'}} æ–¤</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">ç›®æ ‡ä½“é‡</text>
            <text class="stat-value">{{item.target_weight || '-'}} æ–¤</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å·²å‡é‡</text>
            <text class="stat-value {{item.weight_loss > 0 ? 'positive' : ''}}">{{item.weight_loss || '0'}} æ–¤</text>
          </view>
        </view>
        <view class="progress-bar-container" bindtap="navigateToDetail" data-id="{{item.id}}">
          <view class="progress-bar" style="width: {{item.progress || 0}}%"></view>
        </view>
        <view class="progress-text" bindtap="navigateToDetail" data-id="{{item.id}}">å®Œæˆè¿›åº¦: {{item.progress || 0}}%</view>
        <view class="customer-actions">
          <view class="customer-delete" catchtap="deleteCustomer" data-id="{{item.id}}" data-name="{{item.name}}">
            <text class="delete-icon">åˆ é™¤</text>
          </view>
        </view>
      </view>
    </block>
    <view wx:else class="empty-tip">
      <text wx:if="{{!isLoading}}">æš‚æ— å®¢æˆ·æ•°æ®</text>
    </view>
  </view>
  
  <!-- åŠ è½½æ›´å¤šæç¤º -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- æ— æ›´å¤šæ•°æ®æç¤º -->
  <view wx:if="{{!hasMore && customers.length > 0 && !isLoading}}" class="no-more-tip">
    <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
  </view>
  
  <!-- æ·»åŠ å®¢æˆ·æŒ‰é’® -->
  <view class="add-btn" bindtap="navigateToAdd">
    <text class="add-icon">+</text>
  </view>
  
  <!-- åº—é“ºé€‰æ‹©å¼¹çª— -->
  <view class="store-picker-mask" wx:if="{{storePickerVisible}}" bindtap="closeStorePicker">
    <view class="store-picker" catchtap="stopPropagation">
      <view class="store-picker-header">
        <text>é€‰æ‹©åº—é“º</text>
        <view class="close-icon" bindtap="closeStorePicker">Ã—</view>
      </view>
      <view class="store-list">
        <view class="store-item {{selectedStoreId === (item.id || '') ? 'active' : ''}}" 
              wx:for="{{stores}}" 
              wx:key="id" 
              data-index="{{index}}"
              bindtap="selectStore">
          {{item.name}}
        </view>
      </view>
    </view>
  </view>
</view> 