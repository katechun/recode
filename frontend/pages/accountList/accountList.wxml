<view class="container">
  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-filter-bar">
    <view class="search-box">
      <input type="text" placeholder="æœç´¢å¤‡æ³¨å…³é”®è¯" bindinput="onSearchInput" value="{{searchKeyword}}" confirm-type="search"/>
      <view class="search-icon" bindtap="doSearch">ğŸ”</view>
    </view>
    <view class="filter-btn" bindtap="showFilter">
      <text>ç­›é€‰</text>
      <text class="filter-icon">â–¼</text>
    </view>
  </view>
  
  <!-- æ—¥æœŸèŒƒå›´é€‰æ‹© -->
  <view class="date-range-bar">
    <picker mode="date" value="{{startDate}}" bindchange="bindStartDateChange">
      <view class="date-picker">{{startDate}}</view>
    </picker>
    <text class="date-separator">è‡³</text>
    <picker mode="date" value="{{endDate}}" bindchange="bindEndDateChange">
      <view class="date-picker">{{endDate}}</view>
    </picker>
    <button class="date-search-btn" bindtap="applyDateFilter">æŸ¥è¯¢</button>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="statistics-card">
    <view class="statistics-item">
      <text class="statistics-label">æ€»æ”¶å…¥</text>
      <text class="statistics-value income">{{totalIncome || '0.00'}}</text>
    </view>
    <view class="statistics-item">
      <text class="statistics-label">æ€»æ”¯å‡º</text>
      <text class="statistics-value expense">{{totalExpense || '0.00'}}</text>
    </view>
    <view class="statistics-item">
      <text class="statistics-label">å‡€é¢</text>
      <text class="statistics-value {{netAmount >= 0 ? 'income' : 'expense'}}">{{netAmount || '0.00'}}</text>
    </view>
  </view>
  
  <!-- è®°è´¦åˆ—è¡¨ -->
  <scroll-view scroll-y="true" class="account-list-scroll" 
               refresher-enabled="{{true}}" 
               refresher-triggered="{{isRefreshing}}"
               bindrefresherrefresh="onPullDownRefresh"
               bindscrolltolower="onReachBottom"
               style="height: calc(100vh - 380rpx); width: 100%;">
    <view class="account-list" style="padding: 20rpx;">
      <view wx:for="{{accounts}}" wx:key="id" class="account-item" bindtap="viewAccountDetail" data-id="{{item.id}}" style="margin-bottom: 20rpx;">
        <view class="account-left">
          <view class="account-info">
            <text class="account-store">{{item.store_name || 'æœªçŸ¥åº—é“º'}}</text>
            <text class="account-type">{{item.type_name || 'æœªåˆ†ç±»'}}</text>
            <text class="account-user">è®°å½•äºº: {{item.username || 'æœªçŸ¥ç”¨æˆ·'}}</text>
          </view>
          <view class="account-detail">
            <text class="account-time">{{item.formattedDate || item.transaction_time}}</text>
            <text class="account-remark" wx:if="{{item.remark}}">{{item.remark}}</text>
          </view>
        </view>
        <view class="account-right">
          <text class="account-amount {{item.isIncome ? 'income' : 'expense'}}">
            {{item.isIncome ? '+' : ''}}{{item.formattedAmount}}
          </text>
          <view class="account-actions">
            <text class="action-edit" catchtap="editAccount" data-id="{{item.id}}">ç¼–è¾‘</text>
            <text class="action-delete" catchtap="deleteAccount" data-id="{{item.id}}">åˆ é™¤</text>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½çŠ¶æ€æ˜¾ç¤ºåœ¨åˆ—è¡¨å -->
      <view class="loading-more" wx:if="{{isLoading}}" style="text-align: center; padding: 20rpx;">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </view>
  </scroll-view>
  
  <!-- åº•éƒ¨æ·»åŠ æŒ‰é’® -->
  <view class="add-btns">
    <button class="add-btn income" bindtap="navigateToAddAccount" data-type="income">
      <text class="add-icon">+</text>
      <text>æ”¶å…¥</text>
    </button>
    <button class="add-btn expense" bindtap="navigateToAddAccount" data-type="expense">
      <text class="add-icon">-</text>
      <text>æ”¯å‡º</text>
    </button>
  </view>
  
  <!-- ç­›é€‰å¼¹çª— -->
  <view class="filter-modal {{showFilterModal ? 'show' : ''}}" catchtouchmove="preventTouchMove">
    <view class="filter-mask" bindtap="hideFilter"></view>
    <view class="filter-content">
      <view class="filter-header">
        <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
        <text class="filter-close" bindtap="hideFilter">Ã—</text>
      </view>
      
      <view class="filter-body">
        <view class="filter-section">
          <text class="filter-label">åº—é“º</text>
          <picker mode="selector" range="{{stores}}" range-key="name" bindchange="bindStoreChange">
            <view class="filter-selector">
              <text>{{selectedStoreName}}</text>
              <text class="arrow-down">â–¼</text>
            </view>
          </picker>
        </view>
        
        <view class="filter-section">
          <text class="filter-label">è®°è´¦ç±»å‹</text>
          <picker mode="selector" range="{{accountTypes}}" range-key="name" bindchange="bindTypeChange">
            <view class="filter-selector">
              <text>{{selectedTypeName}}</text>
              <text class="arrow-down">â–¼</text>
            </view>
          </picker>
        </view>
        
        <view class="filter-section">
          <text class="filter-label">é‡‘é¢åŒºé—´</text>
          <view class="amount-range">
            <input type="digit" placeholder="æœ€å°é‡‘é¢" value="{{minAmount}}" bindinput="onMinAmountInput" />
            <text class="amount-separator">è‡³</text>
            <input type="digit" placeholder="æœ€å¤§é‡‘é¢" value="{{maxAmount}}" bindinput="onMaxAmountInput" />
          </view>
        </view>
      </view>
      
      <view class="filter-footer">
        <button class="filter-btn reset" bindtap="resetFilter">é‡ç½®</button>
        <button class="filter-btn apply" bindtap="applyFilter">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ è´¦ç›®è¯¦æƒ…å¼¹çª— -->
  <view class="detail-modal {{showDetailModal ? 'show' : ''}}" catchtouchmove="preventTouchMove">
    <view class="detail-mask" bindtap="hideDetail"></view>
    <view class="detail-content">
      <view class="detail-header">
        <text class="detail-title">è´¦ç›®è¯¦æƒ…</text>
        <text class="detail-close" bindtap="hideDetail">Ã—</text>
      </view>
      
      <view class="detail-body">
        <view class="detail-row">
          <text class="detail-label">ç±»å‹</text>
          <text class="detail-value {{currentAccount.isIncome ? 'income' : 'expense'}}">
            {{currentAccount.isIncome ? 'æ”¶å…¥' : 'æ”¯å‡º'}}
          </text>
        </view>
        
        <view class="detail-row">
          <text class="detail-label">é‡‘é¢</text>
          <text class="detail-value {{currentAccount.isIncome ? 'income' : 'expense'}}">
            Â¥{{currentAccount.formattedAmount}}
          </text>
        </view>
        
        <view class="detail-row">
          <text class="detail-label">åº—é“º</text>
          <text class="detail-value">{{currentAccount.store_name || 'æœªçŸ¥åº—é“º'}}</text>
        </view>
        
        <view class="detail-row">
          <text class="detail-label">åˆ†ç±»</text>
          <text class="detail-value">{{currentAccount.type_name || 'æœªåˆ†ç±»'}}</text>
        </view>
        
        <view class="detail-row">
          <text class="detail-label">æ—¶é—´</text>
          <text class="detail-value">{{currentAccount.formattedDate || 'æœªçŸ¥æ—¶é—´'}}</text>
        </view>
        
        <view class="detail-row" wx:if="{{currentAccount.remark}}">
          <text class="detail-label">å¤‡æ³¨</text>
          <text class="detail-value remark">{{currentAccount.remark}}</text>
        </view>
        
        <view class="detail-row">
          <text class="detail-label">è®°å½•äºº</text>
          <text class="detail-value">{{currentAccount.username || 'æœªçŸ¥ç”¨æˆ·'}}</text>
        </view>
      </view>
      
      <view class="detail-footer">
        <button class="detail-btn edit" catchtap="editDetailAccount">ç¼–è¾‘</button>
        <button class="detail-btn delete" catchtap="deleteDetailAccount">åˆ é™¤</button>
      </view>
    </view>
  </view>
</view> 